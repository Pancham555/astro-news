---
import Menu from "@/assets/svgs/menu.astro";
import { NAVIGATION_LINKS, OTHER_LINKS } from "@/lib/config";
---

<div class="sidebar-wrapper">
  <button
    id="sidebar-toggle"
    class="btn btn-circle"
    aria-label="Toggle Menu"
    aria-expanded="false">
    <Menu />
  </button>

  <!-- Overlay -->
  <div id="sidebar-overlay" class="sidebar-overlay"></div>

  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-header bg-base-100">
      <h2 class="text-lg font-bold">Menu</h2>
      <button
        id="sidebar-close"
        class="btn btn-sm btn-circle"
        aria-label="Close Menu">
        âœ•
      </button>
    </div>

    <ul class="menu p-4 w-full h-full bg-base-100">
      <li><a href="/" aria-label="Homepage">Home</a></li>
      <li><a href="/articles" aria-label="Articles Page">Articles</a></li>

      <li>
        <details>
          <summary>Categories</summary>
          <ul>
            {
              NAVIGATION_LINKS.map(({ href, text, target }) => (
                <li>
                  <a href={href} target={target ?? "_self"} aria-label={text}>
                    {text}
                  </a>
                </li>
              ))
            }
          </ul>
        </details>
      </li>

      <li>
        <details>
          <summary>Other Pages</summary>
          <ul>
            {
              OTHER_LINKS.map(({ href, text, target }) => (
                <li>
                  <a href={href} target={target ?? "_self"} aria-label={text}>
                    {text}
                  </a>
                </li>
              ))
            }
          </ul>
        </details>
      </li>
    </ul>
  </aside>
</div>

<style>
  .sidebar-wrapper {
    position: relative;
  }

  .sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 40;
    opacity: 0;
    visibility: hidden;
    transition:
      opacity 0.3s ease,
      visibility 0.3s ease;
  }

  .sidebar-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100%;
    width: 360px;
    background-color: var(--fallback-b1, oklch(var(--b1)));
    z-index: 50;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    overflow-y: auto;
    overflow-x: hidden;
    box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
  }

  .sidebar.active {
    transform: translateX(0);
  }

  .sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    border-bottom: 1px solid var(--fallback-bc, oklch(var(--bc) / 0.1));
    /* background-color: var(--fallback-b1, oklch(var(--b1))); */
  }

  .sidebar-header button {
    background-color: var(--fallback-b2, oklch(var(--b2)));
    border: 1px solid var(--fallback-bc, oklch(var(--bc) / 0.2));
  }

  .sidebar-header button:hover {
    background-color: var(--fallback-b3, oklch(var(--b3)));
  }

  #sidebar-toggle {
    background-color: var(--fallback-b2, oklch(var(--b2))) !important;
    border: 1px solid var(--fallback-bc, oklch(var(--bc) / 0.2)) !important;
  }

  #sidebar-toggle:hover {
    background-color: var(--fallback-b3, oklch(var(--b3))) !important;
  }

  /* Prevent body scroll when sidebar is open */
  body.sidebar-open {
    overflow: hidden;
  }
</style>

<script>
  const toggle = document.getElementById("sidebar-toggle");
  const close = document.getElementById("sidebar-close");
  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("sidebar-overlay");

  function openSidebar() {
    sidebar?.classList.add("active");
    overlay?.classList.add("active");
    document.body.classList.add("sidebar-open");
    toggle?.setAttribute("aria-expanded", "true");
  }

  function closeSidebar() {
    sidebar?.classList.remove("active");
    overlay?.classList.remove("active");
    document.body.classList.remove("sidebar-open");
    toggle?.setAttribute("aria-expanded", "false");
  }

  toggle?.addEventListener("click", openSidebar);
  close?.addEventListener("click", closeSidebar);
  overlay?.addEventListener("click", closeSidebar);

  // Close on escape key
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && sidebar?.classList.contains("active")) {
      closeSidebar();
    }
  });
</script>
